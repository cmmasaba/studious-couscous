# SIMPLE REST API SERVICE

## Table of Contents
1. [Description](#description)
2. [Database models and design](#database-models-and-design)
    - [Customers](#customers-model)
    - [Models](#orders-model)
3. [REST API](#rest-api)
    - [Endpoints](#endpoints)
        - [API root](#api-root)
        - [Customers endpoint](#customers-endpoint)
        - [Orders endpoint](#orders-endpoint)
        - [Authentication endpoint](#authentication-endpoint)
        - [Documentation and Schema endpoint](#documentation-and-schema-endpoint)
4. [Authentication and Authorization](#authentication-endpoint)
5. [SMS Notifications](#sms-notifications)
6. [API Documentation](#api-documentation)
7. [Contributions and License](#contributions-and-license)


## 1. Description
This project is about building a Python REST API service with very minimalistic databases for customers and users.<br>
The REST API implementation uses the awesome [Django REST framework](https://www.django-rest-framework.org/ "The Django REST framework docs homepage"). It should support CRUD operations on the database models instances.<br>
Authentication and authorization of users is done using OpenID Connect.

## 2. Database Models and Design
<img src="static/images/db_design.png" width="1000" height="600" ><br>
<br>The underlying database server used for this service is PostgreSQL. The database models are designed to be very simple.

#### 2.1 Customers model
The customers have very few details.
- first_name: customer's first name.
- second_name: customer's second name.
- code: a 5-digit alphanumeric code unique to each customer.
- phone: customer's phone number, which is used for sending updates when an order is placed in their name. Phone number should be entered in international format, e.g. +254712345678
- id: autogenerated and used as the Primary Key.

#### 2.2 Orders model
Similarly the orders model is kept simple.
- item: name of the item to be bought. An order can only have one item in it.
- quantity: the number of units of the item being bought.
- price_per_unit: the price of each unit of the item.
- status: the status of the order. This is an enum with the following values; `Pending`, `Closed`, `Cancelled`. The default is `Pending`.
- customer_code: the code of the customer to whom the order belongs. The code is used internally for bookkeeping practices like relating an order to a customer.
- time_placed: hold the time the order was placed. It is autofilled when an order is created.
- customer: a Foreign Key that associates a specific customer to an order instance. The relationship between an order and a customer is many-to-one. Many orders can belong to a single customer.
- id: autogenrated and used as Primary Key
##### Items
This was supposed to be a model for items that can be ordered. Out of the interes of time I did not pursue this idea for long. In due time I will revisit it. The idea is that there should be a dropdown field of items for a user to select from when placing an order.<br>


## 3. REST API
The API serive is built using [Django REST framework](https://www.django-rest-framework.org/ "The Django REST framework docs homepage").<br>
The browsable API can be accessed [here](https://studious-couscous-3195451bc2ab.herokuapp.com/api/v1/ "Link to the browsable API").<br>
For detailed description of supported HTTP methods, how to invoke them, and expected responses, check out the [`API docs`](#api-documentation).<br>

### 3.1 Endpoints
#### 3.1.1 Api root
- `/api/v1/`: the API root, has links to the customers and orders endpoints.
#### 3.1.2 Customers endpoint
- `/api/v1/customers/`: list all customer instances belonging to the user.
- `/api/v1/customers/`: create a new customer instance.
- `/api/v1/customers/<pk>/`: perform an action on the specified customer instance.
#### 3.1.3 Orders endpoint
- `/api/v1/orders/`: list all order instances belonging to the user.
- `/api/v1/orders/`: create a new order instance.
- `/api/v1/orders/<pk>/`: perform an action on the specified order instance 
#### 3.1.4 Authentication endpoint
- `/api/v1/api-auth/authenticate/`: login to the API using OpenID Connect and go to the home page.
- `/api/v1/api-auth/logout/`: logout from the API and return to the home page.
#### 3.1.5 Documentation and Schema endpoint
- `/api/schema/`: download the schema.
- `/api/v1/docs/`: view the redoc.
- `/api/v1/swagger-docs/`: view the Swagger formatted docs.

## 4. Authentication and Authorization
[OpenID Connect](https://auth0.com/docs/authenticate/protocols/openid-connect-protocol#:~:text=OpenID%20Connect%20(OIDC)%20is%20an,to%20the%20OAuth%202.0%20specifications. "The OpenID Connect Protocol homepage") is used to provide authentication to API. The OpenID Connect provider used is [Google](https://developers.google.com/identity/openid-connect/openid-connect#python "The Google OpenID Connect specification page").<br>
To implement this feature I used a third party library, [Mozilla OIDC](https://mozilla-django-oidc.readthedocs.io/en/stable/installation.html, "Mozilla OIDC docs homepage"), which makes the task remarkably easy.<br>
To enforce authorization, I used the `permission_classes` of Django REST to ensure only authenticated users can create, read, update or delete the models.<br>
#### Warning
Having the `IsAuthenticated` as the only permission class is security flaw. That means any authenticated user can perform any kind of operation on the customer/order instances even if they did not create them. This will be problematic in a setting where the API is used by many parties.<br>
I implemented the `object level permissions`, but there is a subtle bug that is causing that mechanism to fail. And so I cannot use it yet in production but the code is there. Until I figure out where the bug is, let's assume the API will be used by only one person.<br>

## 5. SMS Notifications
When an order is placed, an SMS notification is sent to the related customer using the [Africa's Talking](https://africastalking.com/, "Africa's Talking Homepage") gateway.<br>
For testing purposes I am using the Sandbox app, therefore the messages are delivered to the sandbox app.<br>
The screenshot below shows it works as expected.<br>
<img src="static/images/sms_confirmation.png" width="550" height="600" ><br>


## Tests
Unittests followed the usual Django testing procedures. For coverage tests I used the `coverage` module in combination with `djang-coverage-plugin`.

## 6. API Documentation
This API's schema and documentation has been generated in accordance to the [OpenAPI](https://www.openapis.org/ "OpenAPI homepage") specifications.<br>
Please visit these links for in-depth details:
- [Redocs](https://studious-couscous-3195451bc2ab.herokuapp.com/api/v1/docs/ "View API Redoc"): View Redocs
- [Swagger Docs](https://studious-couscous-3195451bc2ab.herokuapp.com/api/v1/swagger-docs/ "View API Swagger docs"): View Swagger docs
- [API Schema](https://studious-couscous-3195451bc2ab.herokuapp.com/api/schema/ "Download API Schema"): Download Schema

## 7. Contributions and License
This work was done as part of the screening test for the backend developer role at Savannah Informatics, and is protected by the [MIT License](LICENSE "MIT License for the project"), all rights reserved.<br>

